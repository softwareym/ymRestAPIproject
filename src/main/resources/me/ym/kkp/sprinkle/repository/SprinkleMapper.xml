<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="me.ym.kkp.sprinkle.repository.SprinkleMapper">

    <!--3. 조회 API ● 다음 조건을 만족하는 조회 API를 만들어 주세요.
    ○ 뿌리기 시 발급된 token을 요청값으로 받습니다.
    ○ token에 해당하는 뿌리기 건의 현재 상태를 응답값으로 내려줍니다. 현재 상태는 다음의 정보를 포함합니다.
    ○ 뿌린 시각, 뿌린 금액, 받기 완료된 금액,
       받기 완료된 정보 ([받은 금액, 받은 사용자 아이디] 리스트) =>
    ○ 뿌린 사람 자신만 조회를 할 수 있습니다.     다른사람의 뿌리기건이나 유효하지 않은 token에 대해서는 조회 실패 응답이 내려가야 합니다.
    ○ 뿌린 건에 대한 조회는 7일 동안 할 수 있습니다.  -->
    <!-- 뿌리기 조회 -->
    <select id="selectMySprinkle" resultType="Sprinkle">
       select
         M.seq , M.token, M.roomId, M.sprinklerId, M.sprinklerPrice, D.sum(receiverPrice) as receiverTotPrice
        from tblSprinkle M
        left outer join tblReceivers D
        on M.token  = D.token
        where M.token = #{token}
        group by M.seq, M.token, M.roomId, M.sprinklerId, M.sprinklerPrice
    </select>

    <!-- 뿌리기 조회 [받는사람 정보 리스트]-->
    <select id="selectMyReceiver" resultType="Sprinkle">
       select
         receiverOrder, receiverId, receiverPrice, receiveDate
        from tblReceivers
        where token = #{token}
    </select>


</mapper>